--
-- VHDL ARCHITECTURE ECE411.REGFILE_DP.UNTITLED
--
-- CREATED:
--          BY - HERSTAD.STDT (EESN26.EWS.UIUC.EDU)
--          AT - 14:27:47 03/31/03
--
-- GENERATED BY MENTOR GRAPHICS' HDL DESIGNER(TM) 2001.5 (BUILD 170)
--
-- HDS INTERFACE_START
LIBRARY IEEE;
USE IEEE.STD_LOGIC_1164.ALL;
USE IEEE.NUMERIC_STD.ALL;
LIBRARY ECE411;
USE ECE411.LC3B_TYPES.ALL;

ENTITY REGFILE_DP IS
PORT( 
	CLK        : IN     STD_LOGIC;
	DEST_1     : IN     LC3B_REG;
	DIN_1      : IN     LC3B_WORD;
	RESET_L    : IN     STD_LOGIC;
	REGWRITE_1 : IN     STD_LOGIC;
	SRCA_1     : IN     LC3B_REG;
	SRCB_1     : IN     LC3B_REG;
	A_1        : OUT    LC3B_WORD;
	B_1        : OUT    LC3B_WORD;
	DIN_2      : IN     LC3B_WORD;
	SRCA_2     : IN     LC3B_REG;
	SRCB_2     : IN     LC3B_REG;
	DEST_2     : IN     LC3B_REG;
	REGWRITE_2 : IN     STD_LOGIC;
	A_2        : OUT    LC3B_WORD;
	B_2        : OUT    LC3B_WORD
);
-- DECLARATIONS
END REGFILE_DP ;

-- HDS INTERFACE_END
ARCHITECTURE UNTITLED OF REGFILE_DP IS
TYPE RAMMEMORY IS ARRAY (7 DOWNTO 0) OF LC3B_WORD;
SIGNAL RAM : RAMMEMORY;
BEGIN
	VHDL_REGFILE_READ1 : PROCESS (RAM, SRCA_1, SRCB_1)
	VARIABLE RADDR1 : INTEGER RANGE 0 TO 7;
	VARIABLE RADDR2 : INTEGER RANGE 0 TO 7;
	BEGIN
		-- READ REGFILE PROCESS #1.
		-- CONVERT ADDRESSES TO INTEGERS TO USE AS AN INDEX INTO THE ARRAY.
		RADDR1 := TO_INTEGER(UNSIGNED(SRCA_1));
		RADDR2 := TO_INTEGER(UNSIGNED(SRCB_1));
		A_1 <= RAM(RADDR1) AFTER DELAY_REGFILE_READ2;
		B_1 <= RAM(RADDR2) AFTER DELAY_REGFILE_READ2;
	END PROCESS VHDL_REGFILE_READ1;

	VHDL_REGFILE_READ2 : PROCESS (RAM, SRCA_2, SRCB_2)
	VARIABLE RADDR1 : INTEGER RANGE 0 TO 7;
	VARIABLE RADDR2 : INTEGER RANGE 0 TO 7;
	BEGIN
		-- READ REGFILE PROCESS #2.
		-- CONVERT ADDRESSES TO INTEGERS TO USE AS AN INDEX INTO THE ARRAY.
		RADDR1 := TO_INTEGER(UNSIGNED(SRCA_2));
		RADDR2 := TO_INTEGER(UNSIGNED(SRCB_2));
		A_2 <= RAM(RADDR1) AFTER DELAY_REGFILE_READ2;
		B_2 <= RAM(RADDR2) AFTER DELAY_REGFILE_READ2;
	END PROCESS VHDL_REGFILE_READ2;

	VHDL_REGFILE_WRITE: PROCESS(CLK, DIN_1, DIN_2, REGWRITE_1, REGWRITE_2, DEST_1, DEST_2, RESET_L)
	VARIABLE WADDR1 : INTEGER RANGE 0 TO 7;
	VARIABLE WADDR2 : INTEGER RANGE 0 TO 7;
	BEGIN
		-- RESET REGFILE ON RESET SIGNAL
		IF (RESET_L = '0') THEN --LOW ENABLE
			RAM(0) <= "0000000000000000";
			RAM(1) <= "0000000000000000";
			RAM(2) <= "0000000000000000";
			RAM(3) <= "0000000000000000";
			RAM(4) <= "0000000000000000";
			RAM(5) <= "0000000000000000";
			RAM(6) <= "0000000000000000";
			RAM(7) <= "0000000000000000";
		END IF;

		-- CONVERT ADDRESS TO INTEGER
		WADDR1 := TO_INTEGER(UNSIGNED(DEST_1));
		WADDR2 := TO_INTEGER(UNSIGNED(DEST_2));
		IF (CLK'EVENT AND (CLK = '1') AND (CLK'LAST_VALUE = '0')) THEN
			IF (REGWRITE_1 = '1') THEN
				RAM(WADDR1) <= DIN_1;
			END IF;
			IF (REGWRITE_2 = '1') THEN
				RAM(WADDR2) <= DIN_2;
			END IF;
		END IF;
	END PROCESS VHDL_REGFILE_WRITE;
END UNTITLED;