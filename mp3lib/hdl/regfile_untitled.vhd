--
-- VHDL ARCHITECTURE ECE411.REGFILE.UNTITLED
--
-- CREATED:
--          BY - HERSTAD.STDT (EESN26.EWS.UIUC.EDU)
--          AT - 14:27:47 03/31/03
--
-- GENERATED BY MENTOR GRAPHICS' HDL DESIGNER(TM) 2001.5 (BUILD 170)
--
-- HDS INTERFACE_START
LIBRARY IEEE;
USE IEEE.STD_LOGIC_1164.ALL;
USE IEEE.NUMERIC_STD.ALL;
LIBRARY ECE411;
USE ECE411.LC3B_TYPES.ALL;

ENTITY REGFILE IS
PORT( 
	CLK      : IN     STD_LOGIC;
	DEST     : IN     LC3B_REG;
	DIN      : IN     LC3B_WORD;
	RESET_L  : IN     STD_LOGIC;
	REGWRITE : IN     STD_LOGIC;
	SRCA     : IN     LC3B_REG;
	SRCB     : IN     LC3B_REG;
	A        : OUT    LC3B_WORD;
	B        : OUT    LC3B_WORD
);
-- DECLARATIONS
END REGFILE ;

-- HDS INTERFACE_END
ARCHITECTURE UNTITLED OF REGFILE IS
TYPE RAMMEMORY IS ARRAY (7 DOWNTO 0) OF LC3B_WORD;
SIGNAL RAM : RAMMEMORY;
BEGIN
	VHDL_REGFILE_READ : PROCESS (RAM, SRCA, SRCB)
	VARIABLE RADDR1 : INTEGER RANGE 0 TO 7;
	VARIABLE RADDR2 : INTEGER RANGE 0 TO 7;
	BEGIN
		-- READ REGFILE PROCESS.
		-- CONVERT ADDRESSES TO INTEGERS TO USE AS AN INDEX INTO THE ARRAY.
		RADDR1 := TO_INTEGER(UNSIGNED(SRCA));
		RADDR2 := TO_INTEGER(UNSIGNED(SRCB));
		A <= RAM(RADDR1) AFTER DELAY_REGFILE_READ;
		B <= RAM(RADDR2) AFTER DELAY_REGFILE_READ;
	END PROCESS VHDL_REGFILE_READ;

	VHDL_REGFILE_WRITE: PROCESS(CLK, DIN, REGWRITE, DEST, RESET_L)
	VARIABLE WADDR : INTEGER RANGE 0 TO 7;
	BEGIN
		-- RESET REGFILE ON RESET SIGNAL
		IF (RESET_L = '0') THEN --LOW ENABLE
			RAM(0) <= "0000000000000000";
			RAM(1) <= "0000000000000000";
			RAM(2) <= "0000000000000000";
			RAM(3) <= "0000000000000000";
			RAM(4) <= "0000000000000000";
			RAM(5) <= "0000000000000000";
			RAM(6) <= "0000000000000000";
			RAM(7) <= "0000000000000000";
		END IF;

		-- CONVERT ADDRESS TO INTEGER
		WADDR := TO_INTEGER(UNSIGNED(DEST));
		IF (CLK'EVENT AND (CLK = '1') AND (CLK'LAST_VALUE = '0')) THEN
			IF (REGWRITE = '1') THEN
				RAM(WADDR) <= DIN;
			END IF;
		END IF;
	END PROCESS VHDL_REGFILE_WRITE;
END UNTITLED;